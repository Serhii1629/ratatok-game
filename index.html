<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RATATOK</title>

<style>
body {
  margin: 0;
  background: #0b0b0b;
  color: white;
  font-family: Arial;
  text-align: center;
}
header { padding: 10px; font-size: 20px; }
#stats { display:flex; justify-content:space-around; }
#rat {
  margin: 30px auto;
  width: 180px; height: 180px;
  background:#FFD600;
  border-radius:30px;
  display:flex; align-items:center; justify-content:center;
  font-size:80px;
}
button {
  padding:10px 16px;
  margin:4px;
  border-radius:10px;
  border:none;
}
.panel {
  background:#111;
  margin:10px;
  padding:10px;
  border-radius:12px;
}
.hidden { display:none; }
#menu {
  position:fixed;
  bottom:0;
  width:100%;
  background:#111;
  padding:10px;
}
</style>
</head>

<body>

<header>ğŸ€ RATATOK</header>

<div id="stats">
  <div>â­ <span id="points">0</span></div>
  <div>âš¡ <span id="energy">100</span></div>
  <div>ğŸ“ˆ Lv <span id="level">1</span></div>
</div>

<div id="rat">ğŸ€</div>

<div id="tasks" class="panel hidden">
  <h3>ğŸ¯ Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ</h3>
  <div id="taskText"></div>
  <button onclick="closeTasks()">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
</div>

<div id="shop" class="panel hidden">
  <h3>ğŸ›’ ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</h3>
  <button onclick="buyEnergy()">âš¡ +50 ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ (30)</button><br>
  <button onclick="buyAuto()">ğŸ¤– ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€ (200)</button><br>
  <button onclick="closeShop()">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
</div>

<div id="menu">
  <button onclick="openTasks()">ğŸ¯</button>
  <button onclick="openShop()">ğŸ›’</button>
  <button onclick="copyRef()">ğŸ</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

/* ğŸ”¥ FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyB1Ln1WuJyjqFPEE6NblANZj-2P7SS7b40",
  authDomain: "ratatok-33746.firebaseapp.com",
  projectId: "ratatok-33746",
  storageBucket: "ratatok-33746.firebasestorage.app",
  messagingSenderId: "959368453562",
  appId: "1:959368453562:web:35c128b473b74029a71183",
  databaseURL: "https://ratatok-33746-default-rtdb.firebaseio.com"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* USER */
const params = new URLSearchParams(location.search);
const referrer = params.get("ref");

const uid = localStorage.getItem("uid") || "u_" + Math.random().toString(36).slice(2);
localStorage.setItem("uid", uid);

let points=0, energy=100, level=1, auto=false, clicks=0;
let lastClick=0;

/* LOAD */
get(ref(db,"users/"+uid)).then(s=>{
  if(s.exists()){
    let d=s.val();
    points=d.points||0;
    energy=d.energy||100;
    level=d.level||1;
    auto=d.auto||false;
    clicks=d.clicks||0;
    updateUI();
    if(auto) startAuto();
  } else if(referrer){
    update(ref(db,"users/"+referrer),{ points: (points||0)+50 });
  }
});

/* UI */
const pEl=pointsEl, eEl=energyEl, lEl=levelEl;
function updateUI(){
  pEl.textContent=points;
  eEl.textContent=energy;
  lEl.textContent=level;
}

/* SAVE */
function save(){
  set(ref(db,"users/"+uid),{points,energy,level,auto,clicks});
}

/* CLICK + ANTICHEAT */
rat.onclick=()=>{
  const now=Date.now();
  if(now-lastClick<300) return; // Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°
  if(energy<=0) return;
  lastClick=now;

  clicks++;
  points++;
  energy--;
  level = Math.floor(points/100)+1;
  updateUI();
  save();
};

/* ENERGY REGEN */
setInterval(()=>{
  if(energy<100){
    energy++;
    updateUI();
    save();
  }
},3000);

/* AUTO */
function startAuto(){
  setInterval(()=>{
    if(energy>0){
      points++;
      energy--;
      level=Math.floor(points/100)+1;
      updateUI();
      save();
    }
  },2500);
}

/* TASKS */
function openTasks(){
  tasks.classList.remove("hidden");
  taskText.innerHTML = clicks>=20
    ? "âœ… Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾! +50 Ğ¾Ñ‡ĞºĞ¾Ğ²"
    : `Ğ¡Ğ´ĞµĞ»Ğ°Ğ¹ 20 ĞºĞ»Ğ¸ĞºĞ¾Ğ² (${clicks}/20)`;
  if(clicks>=20){
    points+=50;
    clicks=0;
    save();
    updateUI();
  }
}
window.openTasks=openTasks;
window.closeTasks=()=>tasks.classList.add("hidden");

/* SHOP */
window.openShop=()=>shop.classList.remove("hidden");
window.closeShop=()=>shop.classList.add("hidden");
window.buyEnergy=()=>{
  if(points>=30){
    points-=30; energy+=50;
    updateUI(); save();
  }
}
window.buyAuto=()=>{
  if(points>=200 && !auto){
    auto=true; points-=200;
    startAuto(); save();
  }
}

/* REF */
window.copyRef=()=>{
  navigator.clipboard.writeText(location.origin+"?ref="+uid);
  alert("Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°");
}
</script>
</body>
</html>
