<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>RATATOK</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #121212;
    color: white;
}

/* HEADER */
header {
    text-align: center;
    font-size: 24px;
    padding: 16px;
    background: #1f1f1f;
}

/* PANELS */
.panel {
    display: none;
    padding-bottom: 120px;
}
.panel.active {
    display: block;
}

/* GAME CENTER FIX */
.game-center {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

/* RAT FIX */
#rat-wrapper {
    width: 100%;
    display: flex;
    justify-content: center;
}

#rat {
    font-size: 190px;
    margin: 30px 0;
    user-select: none;
}

/* STATS */
.stats {
    font-size: 18px;
    text-align: center;
}

/* MENU */
.menu {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #1f1f1f;
    display: flex;
    justify-content: space-around;
    padding: 20px 0;
    font-size: 22px;
    border-top: 2px solid #333;
}

.menu div {
    padding: 12px 18px;
}

/* BUTTONS */
button {
    width: 90%;
    margin: 10px auto;
    padding: 14px;
    font-size: 18px;
    display: block;
}
</style>
</head>

<body>

<header>ğŸ­ RATATOK</header>

<!-- GAME -->
<div id="game" class="panel active game-center">
    <div id="rat-wrapper">
        <div id="rat">ğŸ€</div>
    </div>
    <div class="stats">
        Ğ¢Ğ°Ğ¿Ñ‹: <span id="score">0</span><br>
        Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ: <span id="energy">100</span>/100<br>
        ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€: <span id="auto">0</span>
    </div>
</div>

<!-- SHOP -->
<div id="shop" class="panel">
    <h2 style="text-align:center">ğŸ›’ ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</h2>
    <button onclick="buyAuto()">ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€ (+1) â€” 200</button>
    <button onclick="buyEnergy()">Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ +50 â€” 100</button>
</div>

<!-- CARDS -->
<div id="cards" class="panel">
    <h2 style="text-align:center">ğŸƒ ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸</h2>
    <div id="cardList"></div>
</div>

<!-- TASKS -->
<div id="tasks" class="panel">
    <h2 style="text-align:center">ğŸ“ Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ</h2>
    <div id="taskList"></div>
</div>

<!-- BONUS -->
<div id="bonus" class="panel">
    <h2 style="text-align:center">ğŸ Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ±Ğ¾Ğ½ÑƒÑ</h2>
    <button onclick="claimBonus()">Ğ—Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ½ÑƒÑ</button>
    <p id="bonusStatus" style="text-align:center"></p>
</div>

<!-- MENU -->
<div class="menu">
    <div onclick="openPanel('game')">ğŸ®</div>
    <div onclick="openPanel('shop')">ğŸ›’</div>
    <div onclick="openPanel('cards')">ğŸƒ</div>
    <div onclick="openPanel('tasks')">ğŸ“</div>
    <div onclick="openPanel('bonus')">ğŸ</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

/* STATE */
let score = Number(localStorage.getItem("score")) || 0;
let energy = Number(localStorage.getItem("energy")) || 100;
let auto = Number(localStorage.getItem("auto")) || 0;
let power = Number(localStorage.getItem("power")) || 1;

/* RATS */
const rats = [
    { taps: 0, icon: "ğŸ€" },
    { taps: 500, icon: "ğŸ" },
    { taps: 2000, icon: "ğŸ­" },
    { taps: 5000, icon: "ğŸ¹" },
    { taps: 15000, icon: "ğŸ‘‘ğŸ­" }
];

/* CARDS */
const cards = Array.from({ length: 20 }, (_, i) => ({
    id: i,
    level: Number(localStorage.getItem(`card_${i}`)) || 0,
    basePrice: 100 * (i + 1),
    bonus: i + 1
}));

/* TASKS */
const tasks = [
    { id: 1, text: "Ğ¡Ğ´ĞµĞ»Ğ°Ğ¹ 100 Ñ‚Ğ°Ğ¿Ğ¾Ğ²", need: 100, reward: 50 },
    { id: 2, text: "Ğ¡Ğ´ĞµĞ»Ğ°Ğ¹ 1000 Ñ‚Ğ°Ğ¿Ğ¾Ğ²", need: 1000, reward: 300 },
    { id: 3, text: "ĞšÑƒĞ¿Ğ¸ Ğ°Ğ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€", needAuto: 1, reward: 200 }
];

/* ELEMENTS */
const scoreEl = document.getElementById("score");
const energyEl = document.getElementById("energy");
const autoEl = document.getElementById("auto");
const ratEl = document.getElementById("rat");

/* SAVE */
function save() {
    localStorage.setItem("score", score);
    localStorage.setItem("energy", energy);
    localStorage.setItem("auto", auto);
    localStorage.setItem("power", power);
}

/* UI */
function updateUI() {
    scoreEl.textContent = score;
    energyEl.textContent = energy;
    autoEl.textContent = auto;

    let currentRat = rats[0].icon;
    rats.forEach(r => { if (score >= r.taps) currentRat = r.icon; });
    ratEl.textContent = currentRat;
}

/* TAP */
ratEl.onclick = () => {
    if (energy <= 0) return;
    score += power;
    energy -= 1;
    updateUI();
    save();
};

/* AUTO */
setInterval(() => {
    if (auto > 0 && energy > 0) {
        const spend = Math.min(auto, energy);
        score += spend;
        energy -= spend;
        updateUI();
        save();
    }
}, 1000);

/* SHOP */
function buyAuto() {
    if (score >= 200) {
        score -= 200;
        auto++;
        updateUI();
        save();
    }
}
function buyEnergy() {
    if (score >= 100) {
        score -= 100;
        energy = Math.min(100, energy + 50);
        updateUI();
        save();
    }
}

/* CARDS */
function renderCards() {
    const list = document.getElementById("cardList");
    list.innerHTML = "";
    cards.forEach(card => {
        const price = card.basePrice * (card.level + 1);
        const btn = document.createElement("button");
        btn.textContent = `ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° ${card.id+1} | Ğ£Ñ€. ${card.level} | Ğ¦ĞµĞ½Ğ° ${price}`;
        btn.onclick = () => {
            if (score >= price) {
                score -= price;
                card.level++;
                power += card.bonus;
                localStorage.setItem(`card_${card.id}`, card.level);
                updateUI();
                save();
                renderCards();
            }
        };
        list.appendChild(btn);
    });
}

/* TASKS */
function renderTasks() {
    const list = document.getElementById("taskList");
    list.innerHTML = "";
    tasks.forEach(t => {
        const done = localStorage.getItem("task_"+t.id);
        if (done) return;

        const btn = document.createElement("button");
        btn.textContent = t.text + " | ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°: " + t.reward;
        btn.onclick = () => {
            if ((t.need && score >= t.need) || (t.needAuto && auto >= t.needAuto)) {
                score += t.reward;
                localStorage.setItem("task_"+t.id, true);
                updateUI();
                save();
                renderTasks();
            }
        };
        list.appendChild(btn);
    });
}

/* DAILY BONUS */
function claimBonus() {
    const last = Number(localStorage.getItem("dailyBonus")) || 0;
    const now = Date.now();
    if (now - last >= 86400000) {
        score += 200;
        localStorage.setItem("dailyBonus", now);
        updateUI();
        save();
        document.getElementById("bonusStatus").textContent = "Ğ‘Ğ¾Ğ½ÑƒÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½!";
    } else {
        document.getElementById("bonusStatus").textContent = "Ğ‘Ğ¾Ğ½ÑƒÑ ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ» ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ";
    }
}

/* MENU */
function openPanel(id) {
    document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    if (id === "cards") renderCards();
    if (id === "tasks") renderTasks();
}

updateUI();
</script>

</body>
</html>
