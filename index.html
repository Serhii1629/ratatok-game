<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RATATOK</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#0b0b0f;
  color:#fff;
  font-family:Arial,sans-serif;
}

/* TOP */
#top{
  display:flex;
  justify-content:space-around;
  padding:12px;
  background:#111;
  font-weight:bold;
}

/* TAP */
#tap-area{
  height:55vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

#rat{
  width:260px;
  height:260px;
  background-size:contain;
  background-repeat:no-repeat;
  background-position:center;
  border-radius:20px;
  transition:transform .08s;
}
#rat:active{transform:scale(1.1)}

/* MENU */
#menu{
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
}
button{
  flex:1;
  padding:14px;
  background:#1c1c28;
  border:none;
  color:#fff;
  font-size:14px;
}
button:disabled{opacity:.4}

/* PANELS */
.panel{
  display:none;
  position:fixed;
  bottom:52px;
  width:100%;
  max-height:50vh;
  overflow:auto;
  background:#14141c;
  padding:10px;
}

/* CARDS */
.card{
  background:#1e1e2c;
  border-radius:12px;
  padding:10px;
  margin-bottom:8px;
}
.common{border:2px solid #555}
.rare{border:2px solid #3b82f6}
.legendary{border:2px solid gold}
</style>
</head>

<body>

<div id="top">
  <div>Coins: <span id="coins">0</span></div>
  <div>Energy: <span id="energy">100</span></div>
  <div>Level: <span id="level">1</span></div>
</div>

<div id="tap-area">
  <div id="rat"></div>
</div>

<div id="shop" class="panel">
  <h3>Магазин</h3>
  <div id="shopItems"></div>
</div>

<div id="cards" class="panel">
  <h3>Карточки</h3>
  <div id="cardItems"></div>
</div>

<div id="ref" class="panel">
  <h3>Реферал</h3>
  <p id="refLink"></p>
</div>

<div id="menu">
  <button onclick="hide()">GAME</button>
  <button onclick="show('shop')">SHOP</button>
  <button onclick="show('cards')">CARDS</button>
  <button onclick="show('ref')">REF</button>
</div>

<script>
/* ---------- КРЫСЫ ---------- */
const RATS=[
 {need:0,img:"https://i.imgur.com/2yaf2wb.png"},
 {need:1000,img:"https://i.imgur.com/6X6Jv6s.png"},
 {need:10000,img:"https://i.imgur.com/m7YQZ9Z.png"},
 {need:100000,img:"https://i.imgur.com/p3xx6Gr.png"},
 {need:1000000,img:"https://i.imgur.com/8vQYF0n.png"}
];

/* ---------- ДАННЫЕ ---------- */
let state=JSON.parse(localStorage.getItem("ratatok"))||{
 coins:0,
 energy:100,
 tap:1,
 auto:0,
 taps:0,
 level:1,
 cards:{},
 ref:false
};

function save(){localStorage.setItem("ratatok",JSON.stringify(state))}

/* ---------- UI ---------- */
const rat=document.getElementById("rat");
const coinsEl=coins,energyEl=energy,levelEl=level;

function update(){
 coinsEl.textContent=state.coins;
 energyEl.textContent=state.energy;
 levelEl.textContent=state.level;

 let r=RATS[0];
 for(let x of RATS) if(state.taps>=x.need) r=x;
 rat.style.backgroundImage=`url(${r.img})`;

 save();
}

/* ---------- TAP ---------- */
rat.onclick=()=>{
 if(state.energy<=0) return;
 state.energy--;
 state.coins+=state.tap;
 state.taps++;
 if(state.taps>=state.level*1000) state.level++;
 update();
};

/* ---------- AUTO ---------- */
setInterval(()=>{
 if(state.auto>0){
  state.coins+=state.auto;
  update();
 }
},1000);

/* ---------- SHOP ---------- */
const SHOP=[
 {id:1,name:"+50 Energy",price:50,energy:50},
 {id:2,name:"Autoclick +1",price:300,auto:1}
];

function renderShop(){
 shopItems.innerHTML="";
 SHOP.forEach(i=>{
  shopItems.innerHTML+=`
  <div class="card common">
   ${i.name}<br>Цена ${i.price}
   <button onclick="buyShop(${i.id})" ${state.coins<i.price?"disabled":""}>Buy</button>
  </div>`;
 });
}

function buyShop(id){
 let i=SHOP.find(x=>x.id==id);
 if(state.coins<i.price) return;
 state.coins-=i.price;
 if(i.energy) state.energy+=i.energy;
 if(i.auto) state.auto+=i.auto;
 update();
 renderShop();
}

/* ---------- CARDS ---------- */
const CARDS=[
 {id:1,name:"+1 tap",price:100,tap:1,rarity:"common"},
 {id:2,name:"+5 tap",price:500,tap:5,rarity:"rare"}
];

function renderCards(){
 cardItems.innerHTML="";
 CARDS.forEach(c=>{
  let lvl=state.cards[c.id]||0;
  let price=c.price*(lvl+1);
  cardItems.innerHTML+=`
  <div class="card ${c.rarity}">
   ${c.name} lvl ${lvl}<br>${price}
   <button onclick="buyCard(${c.id})" ${state.coins<price?"disabled":""}>Buy</button>
  </div>`;
 });
}

function buyCard(id){
 let c=CARDS.find(x=>x.id==id);
 let lvl=state.cards[id]||0;
 let price=c.price*(lvl+1);
 if(state.coins<price) return;
 state.coins-=price;
 state.cards[id]=lvl+1;
 state.tap+=c.tap;
 update();
 renderCards();
}

/* ---------- REF ---------- */
let code=localStorage.getItem("refCode");
if(!code){
 code=Math.random().toString(36).slice(2,8);
 localStorage.setItem("refCode",code);
}
refLink.textContent=location.origin+location.pathname+"?ref="+code;

const url=new URLSearchParams(location.search);
if(url.get("ref")&&!state.ref){
 state.coins+=300;
 state.ref=true;
 alert("Реферальный бонус +300");
}

/* ---------- PANELS ---------- */
function show(id){
 hide();
 document.getElementById(id).style.display="block";
}
function hide(){
 document.querySelectorAll(".panel").forEach(p=>p.style.display="none");
}

/* ---------- INIT ---------- */
renderShop();
renderCards();
update();
</script>
</body>
</html>
