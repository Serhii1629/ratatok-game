<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>RATATOK</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #121212;
    color: white;
}

header {
    text-align: center;
    font-size: 24px;
    padding: 16px;
    background: #1f1f1f;
}

.panel {
    display: none;
    padding-bottom: 110px;
}
.panel.active {
    display: block;
}

.game-center {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

#rat {
    font-size: 190px;
    margin: 30px 0;
    user-select: none;
}

.stats {
    font-size: 18px;
    text-align: center;
}

.menu {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #1f1f1f;
    display: flex;
    justify-content: space-around;
    padding: 20px 0;
    font-size: 22px;
    border-top: 2px solid #333;
}

.menu div {
    padding: 12px 18px;
}

button {
    width: 90%;
    margin: 10px auto;
    padding: 14px;
    font-size: 18px;
    display: block;
}
</style>
</head>

<body>

<header>ğŸ­ RATATOK</header>

<!-- GAME -->
<div id="game" class="panel active game-center">
    <div id="rat">ğŸ€</div>
    <div class="stats">
        Ğ¢Ğ°Ğ¿Ñ‹: <span id="score">0</span><br>
        Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ: <span id="energy">100</span>/100<br>
        ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€: <span id="auto">0</span>
    </div>
</div>

<!-- SHOP -->
<div id="shop" class="panel">
    <h2 style="text-align:center">ğŸ›’ ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</h2>
    <button onclick="buyAuto()">ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€ (+1) â€” 200</button>
    <button onclick="buyEnergy()">Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ +50 â€” 100</button>
</div>

<!-- CARDS -->
<div id="cards" class="panel">
    <h2 style="text-align:center">ğŸƒ ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸</h2>
    <div id="cardList"></div>
</div>

<!-- REF -->
<div id="ref" class="panel">
    <h2 style="text-align:center">ğŸ”— Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»ĞºĞ°</h2>
    <p style="text-align:center" id="refLink"></p>
</div>

<!-- MENU -->
<div class="menu">
    <div onclick="openPanel('game')">ğŸ®</div>
    <div onclick="openPanel('shop')">ğŸ›’</div>
    <div onclick="openPanel('cards')">ğŸƒ</div>
    <div onclick="openPanel('ref')">ğŸ”—</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// ===== Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ• =====
let score = Number(localStorage.getItem("score")) || 0;
let energy = Number(localStorage.getItem("energy")) || 100;
let auto = Number(localStorage.getItem("auto")) || 0;
let power = Number(localStorage.getItem("power")) || 1;

// ===== ĞšĞ Ğ«Ğ¡Ğ« ĞŸĞ Ğ£Ğ ĞĞ’ĞĞ¯Ğœ =====
const rats = [
    { taps: 0, icon: "ğŸ€" },
    { taps: 500, icon: "ğŸ" },
    { taps: 2000, icon: "ğŸ­" },
    { taps: 5000, icon: "ğŸ¹" },
    { taps: 15000, icon: "ğŸ‘‘ğŸ­" }
];

// ===== ĞšĞĞ Ğ¢ĞĞ§ĞšĞ˜ =====
const cards = Array.from({ length: 20 }, (_, i) => ({
    id: i,
    level: Number(localStorage.getItem(`card_${i}`)) || 0,
    basePrice: 100 * (i + 1),
    bonus: i + 1
}));

// ===== Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢Ğ« =====
const scoreEl = document.getElementById("score");
const energyEl = document.getElementById("energy");
const autoEl = document.getElementById("auto");
const ratEl = document.getElementById("rat");
const cardList = document.getElementById("cardList");

// ===== Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ =====
function save() {
    localStorage.setItem("score", score);
    localStorage.setItem("energy", energy);
    localStorage.setItem("auto", auto);
    localStorage.setItem("power", power);
}

function updateUI() {
    scoreEl.textContent = score;
    energyEl.textContent = energy;
    autoEl.textContent = auto;

    let currentRat = rats[0].icon;
    rats.forEach(r => {
        if (score >= r.taps) currentRat = r.icon;
    });
    ratEl.textContent = currentRat;
}

// ===== Ğ¢ĞĞŸ =====
ratEl.onclick = () => {
    if (energy <= 0) return;
    score += power;
    energy -= 1;
    updateUI();
    save();
};

// ===== ĞĞ’Ğ¢ĞĞšĞ›Ğ˜ĞšĞ•Ğ  =====
setInterval(() => {
    if (auto > 0 && energy > 0) {
        const spend = Math.min(auto, energy);
        score += spend;
        energy -= spend;
        updateUI();
        save();
    }
}, 1000);

// ===== ĞœĞĞ“ĞĞ—Ğ˜Ğ =====
function buyAuto() {
    if (score >= 200) {
        score -= 200;
        auto += 1;
        updateUI();
        save();
    }
}

function buyEnergy() {
    if (score >= 100) {
        score -= 100;
        energy = Math.min(100, energy + 50);
        updateUI();
        save();
    }
}

// ===== ĞšĞĞ Ğ¢ĞĞ§ĞšĞ˜ =====
function renderCards() {
    cardList.innerHTML = "";
    cards.forEach(card => {
        const price = card.basePrice * (card.level + 1);
        const btn = document.createElement("button");
        btn.textContent =
            `ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° ${card.id + 1} | Ğ£Ñ€. ${card.level}
Ğ¦ĞµĞ½Ğ°: ${price}
+${card.bonus} Ğº Ñ‚Ğ°Ğ¿Ñƒ`;

        btn.onclick = () => {
            if (score >= price) {
                score -= price;
                card.level += 1;
                power += card.bonus;
                localStorage.setItem(`card_${card.id}`, card.level);
                updateUI();
                save();
                renderCards();
            }
        };
        cardList.appendChild(btn);
    });
}

// ===== Ğ Ğ•Ğ¤Ğ•Ğ ĞĞ› =====
const user = tg.initDataUnsafe.user;
document.getElementById("refLink").textContent =
    user ? `https://t.me/${user.username}?start=ref_${user.id}` : "ĞÑ‚ĞºÑ€Ğ¾Ğ¹ Ñ‡ĞµÑ€ĞµĞ· Telegram";

// ===== ĞœĞ•ĞĞ® =====
function openPanel(id) {
    document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    if (id === "cards") renderCards();
}

updateUI();
</script>

</body>
</html>
